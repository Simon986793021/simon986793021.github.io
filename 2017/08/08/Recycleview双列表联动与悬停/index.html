<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      Recycleview双列表联动与悬停 | Hexo 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="Simon">
    
    

    <meta name="description" content="最近看了别人的一篇blog，也是实现recycleview的双列表联动，同时应用了MVP框架。于是就模仿写了一个类似的双列表联动与悬停。在MVP方面，我仿照的是官方的todo-mvp，感觉写得有点不伦不类了，这里就不详述，另外在实现需求方面，和那个大神相比，也做了许多改变，当然有些具体的难点我没想到，参照了他的思路，然后实现出来了。在开发中，也尝试了其他的方法">
<meta property="og:type" content="article">
<meta property="og:title" content="Recycleview双列表联动与悬停 | Hexo">
<meta property="og:url" content="https://simon986793021.github.io/2017/08/08/Recycleview双列表联动与悬停/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="最近看了别人的一篇blog，也是实现recycleview的双列表联动，同时应用了MVP框架。于是就模仿写了一个类似的双列表联动与悬停。在MVP方面，我仿照的是官方的todo-mvp，感觉写得有点不伦不类了，这里就不详述，另外在实现需求方面，和那个大神相比，也做了许多改变，当然有些具体的难点我没想到，参照了他的思路，然后实现出来了。在开发中，也尝试了其他的方法">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/5051594-95728ac9e9398d71.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/5051594-9b8368426709d3e0.gif?imageMogr2/auto-orient/strip">
<meta property="og:updated_time" content="2017-08-08T03:33:10.365Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Recycleview双列表联动与悬停 | Hexo">
<meta name="twitter:description" content="最近看了别人的一篇blog，也是实现recycleview的双列表联动，同时应用了MVP框架。于是就模仿写了一个类似的双列表联动与悬停。在MVP方面，我仿照的是官方的todo-mvp，感觉写得有点不伦不类了，这里就不详述，另外在实现需求方面，和那个大神相比，也做了许多改变，当然有些具体的难点我没想到，参照了他的思路，然后实现出来了。在开发中，也尝试了其他的方法">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/5051594-95728ac9e9398d71.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/blog/css/uno.css">
    <link rel="stylesheet" href="/blog/css/highlight.css">
    <link rel="stylesheet" href="/blog/css/archive.css">
    <link rel="stylesheet" href="/blog/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">Hexo</a></h1>
        <hr class="panel-cover__divider" />

        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">首页</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">关于</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title="" class="">归档</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">Recycleview双列表联动与悬停</h1>

    

    <div class="post-meta">
      <time datetime="2017-08-08" class="post-meta__date date">2017-08-08</time> 

      <span class="post-meta__tags tags">

          

          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <p>最近看了别人的一篇blog，也是实现recycleview的双列表联动，同时应用了MVP框架。于是就模仿写了一个类似的双列表联动与悬停。在MVP方面，我仿照的是官方的todo-mvp，感觉写得有点不伦不类了，这里就不详述，另外在实现需求方面，和那个大神相比，也做了许多改变，当然有些具体的难点我没想到，参照了他的思路，然后实现出来了。在开发中，也尝试了其他的方法<br><img src="http://upload-images.jianshu.io/upload_images/5051594-95728ac9e9398d71.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="预览.png"><a id="more"></a></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近看了别人的一篇blog，也是实现recycleview的双列表联动，同时应用了MVP框架。于是就模仿写了一个类似的双列表联动与悬停。在MVP方面，我仿照的是官方的todo-mvp，感觉写得有点不伦不类了，这里就不详述，另外在实现需求方面，和那个大神相比，也做了许多改变，当然有些具体的难点我没想到，参照了他的思路，然后实现出来了。在开发中，也尝试了其他的方法：<br>1.在点击左边省份时，若右边的省份在下面不可见区域，会出现bug，后面会详述。<br>2.滑动右边城市区域是，想和左边的省份联动，当时也用了其他方法，但是失败了，后面也会具体讲到。<br>最后想说一点：看别人的代码要有耐心，刚开始看的时候也是一脸懵逼，后面静下心来慢慢看，看到后面就觉得很简单了。多看，多写，多尝试，多思考。</p>
<h2 id="实现的功能"><a href="#实现的功能" class="headerlink" title="实现的功能"></a>实现的功能</h2><p>先直接上一个效果图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5051594-9b8368426709d3e0.gif?imageMogr2/auto-orient/strip" alt="show.gif"></p>
<p>然后再来分析实现的功能：<br>1.点击左边省份，省份背景改变，右边顶部显示省份悬停，下面显示省份的城市；<br>2.滑动右边的城市，顶部省份悬停，左边随着省份的改变而改变；<br>3.所有控件可点击；<br>4.仿官方mvpdemo的mvp框架；<br>5.snackbar的使用；<br>6.recycleview的花式使用。</p>
<p>下面在来分析下实现的思路：</p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>之前就说了思路是非常重要的，下面来详细说说如果有一个这种需求，改从何下手：<br>先看效果分析大概：<br>1：可以把左边和右边的布局各设置为一个Recycleview；<br>2：点击左边省份，右边需要跟着滑动，是不是可以计算需要滑动的距离，然后通过recycleview的方法进行指定滑动呢。只是一种猜想，实际比这复杂一点；<br>3：滑动右边的城市，然后左边省份需要跟着滑动，更改背景颜色，试想下，通过判断滑动的position，然后计算滑动到了哪个省份，进行改变呢。</p>
<p>接下来我再来详细说下实现的过程：</p>
<p>1.通过RecycleView加载左边的省份，省份是在一个String-array下定义的，然后获取资源，通过适配器加载出来；<br>2.通过RecycleView加载右边的数据，这个时候要注意了，因为左边数据和右边数据是对应的，所以我们通过遍历String-array下的省份，然后往不同的省份注入不同的城市，从效果可以看出来，我们右边不只是简单的布局，可以看出来上面有一个title（省份），下面是显示content（城市），我们通过在设置城市数据时候给一个isTitle来区分省份和城市，后面布局也通过isTitle来区分，我们可以看出右边省份是一行只有一个数据，而城市有三个数据。然后通过不同的布局显示出来。到这里，我们的将数据显示出来了。<br>3.点击省份，背景颜色改变，就是讲点击的item设置成你想要的颜色，没有点击的就是其他颜色了，通过position判断，右边的城市需要滑动，主要通过计算滑动的position。比较麻烦，后面具体讲。<br>4.滑动右边的数据，前面我们在加载城市数据的时候，我们将城市和省份通过一个tag进行了绑定，当我们滑动的时候，获取这个tag（position）,让他与左边的position比较，不相同的话，就把tag赋值给position，有了这个position，我们就可以更改背景颜色了；<br>5.由于滑动的时候会出现bug，我们将左边选中的省份一直显示在屏幕中间。通过recycleView设置下就可以。<br>6.所有都可点击，recycleView的点击事件属于RecycleView的基础，不清楚的可以看我的一个demo：</p>
<p><a href="https://github.com/Simon986793021/RecycleView" target="_blank" rel="external">https://github.com/Simon986793021/RecycleView</a></p>
<h1 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h1><p>实现过程也按照思路来</p>
<h2 id="1-加载左边城市的数据："><a href="#1-加载左边城市的数据：" class="headerlink" title="1.加载左边城市的数据："></a>1.加载左边城市的数据：</h2><p>通过RecycleView加载左边的省份，省份是在一个String-array下定义的，然后获取资源，通过适配器加载出来；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">String [] province=getResources().getStringArray(R.array.province);//获取省份</div><div class="line">      final List&lt;String&gt; list= Arrays.asList(province);</div><div class="line">      /*</div><div class="line">      适配数据和设置监听事件</div><div class="line">       */</div><div class="line">      adapter=new ProvinceRvAdapter(this, list, new ItemClickListener() &#123;</div><div class="line">          @Override</div><div class="line">          public void onItemClick(View view, int position) &#123;</div><div class="line">              Utils.showSnackBar(recycleview,list.get(position));</div><div class="line">              mposition=position;</div><div class="line">              startMove(position,true);</div><div class="line">              Log.i(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&quot;,&quot;position:&quot;+position);</div><div class="line">              moveToCenter(position);</div><div class="line">          &#125;</div><div class="line">      &#125;);</div><div class="line">      recycleview.setAdapter(adapter);</div></pre></td></tr></table></figure></p>
<h2 id="2-加载右边城市数据："><a href="#2-加载右边城市数据：" class="headerlink" title="2.加载右边城市数据："></a>2.加载右边城市数据：</h2><p>通过RecycleView加载右边的数据，这个时候要注意了，因为左边数据和右边数据是对应的，所以我们通过遍历String-array下的省份，然后往不同的省份注入不同的城市，从效果可以看出来，我们右边不只是简单的布局，可以看出来上面有一个title（省份），下面是显示content（城市），我们通过在设置城市数据时候给一个isTitle来区分省份和城市，后面布局也通过isTitle来区分，我们可以看出右边省份是一行只有一个数据，而城市有三个数据。然后通过不同的布局显示出来。到这里，我们的将数据显示出来了。</p>
<p>1.先看下bean对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">public class CityBean &#123;</div><div class="line">    public String city;</div><div class="line">    public boolean isTitle;//判断是否为省份，来进行加载数据</div><div class="line">    public String province;</div><div class="line">    public String tag;//一个position，同时将城市与省份绑定</div><div class="line">    public void setTitle(boolean title)</div><div class="line">    &#123;</div><div class="line">        isTitle=title;</div><div class="line">    &#125;</div><div class="line">    public void setProvince (String province)</div><div class="line">    &#123;</div><div class="line">        this.province=province;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    public String getProvince()</div><div class="line">    &#123;</div><div class="line">        return province;</div><div class="line">    &#125;</div><div class="line">    public boolean isTitle()</div><div class="line">    &#123;</div><div class="line">        return  isTitle;</div><div class="line">    &#125;</div><div class="line">    public void setCity(String city)</div><div class="line">    &#123;</div><div class="line">        this.city=city;</div><div class="line">    &#125;</div><div class="line">    public String getCity()</div><div class="line">    &#123;</div><div class="line">        return city;</div><div class="line">    &#125;</div><div class="line">    public void setTag(String tag)</div><div class="line">    &#123;</div><div class="line">        this.tag=tag;</div><div class="line">    &#125;</div><div class="line">    public String getTag()</div><div class="line">    &#123;</div><div class="line">        return tag;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.获取数据源：<br>通过遍历省份，给省份添加城市数据；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">for (int i=0;i&lt;province.length;i++)</div><div class="line">          &#123;</div><div class="line">              CityBean titleBean=new CityBean();</div><div class="line">              titleBean.setProvince(province[i]);</div><div class="line">              titleBean.setTitle(true);//设置为title</div><div class="line">              titleBean.setTag(String.valueOf(i));//设置tag，方便获取position</div><div class="line">              list.add(titleBean);</div><div class="line"></div><div class="line">              for (int j=0;j&lt;citylist.get(i).length;j++)</div><div class="line">              &#123;</div><div class="line">                  CityBean cityBean=new CityBean();</div><div class="line">                  cityBean.setCity(citylist.get(i)[j]);</div><div class="line">                  cityBean.setTag(String.valueOf(i));//设置成和省份一样的tag，将省份与城市绑定。</div><div class="line">                  list.add(cityBean);</div><div class="line">              &#125;</div><div class="line"></div><div class="line"></div><div class="line">          &#125;</div></pre></td></tr></table></figure>
<p>3.通过设置的isTitle与否来加载数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">int itemViewTtpe=CityRvAdapter.this.getItemViewType(position);</div><div class="line">           switch (itemViewTtpe)</div><div class="line">           &#123;</div><div class="line">               case 0://省份</div><div class="line">                   title.setText(list.get(position).getProvince());</div><div class="line">                   break;</div><div class="line">               case 1://城市</div><div class="line">                   city.setText(list.get(position).getCity());</div><div class="line">                   break;</div><div class="line">               case 2:</div><div class="line">                   break;</div><div class="line">           &#125;</div></pre></td></tr></table></figure>
<p>具体就不详细讲，代码中也有。</p>
<h2 id="左边联动右边（省份联动城市）"><a href="#左边联动右边（省份联动城市）" class="headerlink" title="左边联动右边（省份联动城市）"></a>左边联动右边（省份联动城市）</h2><p>点击省份，背景颜色改变，就是讲点击的item设置成你想要的颜色，没有点击的就是其他颜色了，通过position判断，右边的城市需要滑动，主要通过计算滑动的position。</p>
<p>1.背景的改变：</p>
<p>获取点击的position，传到adapter中，然后进行判断，进行背景改变：</p>
<p>贴出关键代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">if (position==clickPositon)</div><div class="line">           &#123;</div><div class="line">               view.setBackgroundColor(Color.parseColor(&quot;#9EABF4&quot;));</div><div class="line">               textView.setTextColor(Color.parseColor(&quot;#ffffff&quot;));</div><div class="line">           &#125;</div><div class="line">           else &#123;</div><div class="line">               view.setBackgroundColor(Color.parseColor(&quot;#00FFFFFF&quot;));//设置为透明的，因为白色会覆盖分割线</div><div class="line">               textView.setTextColor(Color.parseColor(&quot;#1e1d1d&quot;));</div><div class="line">           &#125;</div><div class="line">           textView.setText(s);</div><div class="line">       &#125;</div></pre></td></tr></table></figure>
<p>2.左边联动右边：</p>
<p>建议先看这篇blog，滑动定位的解决方案：<br><a href="http://blog.csdn.net/tyzlmjj/article/details/49227601" target="_blank" rel="external">http://blog.csdn.net/tyzlmjj/article/details/49227601</a></p>
<p>通过计算需要滑动的距离来进行滑动</p>
<p>我们先计算需要滑动的position：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">for (int i=0;i&lt;position;i++)//position 为点击的position</div><div class="line">       &#123;</div><div class="line">           Log.i(&quot;&lt;&lt;&lt;&lt;&lt;&lt;&quot;,i+&quot;:&quot;+cityFragment.citylist.get(i).length);</div><div class="line">           counts+=cityFragment.citylist.get(i).length;//计算需要滑动的城市数目</div><div class="line">       &#125;</div><div class="line">       if (isLeft)</div><div class="line">       &#123;</div><div class="line">           cityFragment.setCounts(counts+position);//加上title（省份）数目</div><div class="line">       &#125;</div></pre></td></tr></table></figure>
<p>官方提供了两种滑动方案：<br>1.scrollToPosition(int)<br>滑动到指定的item</p>
<p>2.scrollBy(int x,int y)<br>滑动到指定的距离</p>
<p>一开始用的scrollToPosition(int)，但是在实际开发终于到了问题</p>
<p>scrollToposition 只能将item显示出来，至于显示在哪里他就不管了，不过有一点可以肯定的，若item从不可见滑动到可见，一般会出现在最底部，而我们需要的是在最顶部，显然是不行的。我们可以通过用scrollToPosition()和scrollBy 结合使用。</p>
<p>我们可以将滑动分为三种情况：<br>第一种：从上往下滑动（目标item不可见），这种最复杂，需要scrollToPosition()和scrollBy 结合使用，监听scroll接口；</p>
<p>第二种：从上往下滑动（目标item可见），scrollBy就可以解决；</p>
<p>第三种：从下往上滑动，目标可见不可见一样，调用scrollToPosition()都会显示在顶部;</p>
<p>贴出具体代码与我尝试的其他方法（在注释中）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"> int firstItem=gridLayoutManager.findFirstVisibleItemPosition();//获取屏幕可见的第一个item的position</div><div class="line">        int lastItem=gridLayoutManager.findLastVisibleItemPosition();//获取屏幕可见的最后一个item的position</div><div class="line">        if (moveCounts&lt;firstItem)</div><div class="line">        &#123;</div><div class="line">            recyclerView.scrollToPosition(moveCounts);</div><div class="line">        &#125;</div><div class="line">        else if (moveCounts&lt;lastItem)</div><div class="line">        &#123;</div><div class="line">            View aimsView=recyclerView.getChildAt(moveCounts-firstItem);</div><div class="line">            int top =aimsView.getTop();</div><div class="line">            recyclerView.scrollBy(0,top);</div><div class="line">        &#125;</div><div class="line">        else &#123;</div><div class="line">            /*</div><div class="line">            当往下滑动的position大于可见的最后一个item的时候，调用 recyclerView.scrollToPosition(moveCounts);</div><div class="line">            只能讲item滑动到屏幕的底部。</div><div class="line">             */</div><div class="line">            /*</div><div class="line">            第一种方案：先将item移动到底部，然后在调用scrollBy移动到顶部。不可行，不能讲item滑动到顶部，</div><div class="line">            离上面还有一小段距离；</div><div class="line">             recyclerView.scrollToPosition(moveCounts);</div><div class="line">            int top=recyclerView.getHeight();</div><div class="line">            recyclerView.scrollBy(0,top);</div><div class="line"></div><div class="line">            第二种方案：直接计算要滑动的距离。程序崩溃，报空指针。看系统源码可知，当</div><div class="line">            滑动的距离大于ChildCount（可见的item数目），将返回空。</div><div class="line">            int top=recyclerView.getChildAt(moveCounts-firstItem).getTop();</div><div class="line">            recyclerView.scrollBy(0,top);</div><div class="line"></div><div class="line">            第三种解决方案：先将目标item滑动到底部，然后进行异步处理。调用滚动监听方法RecyclerViewListener，滑动到顶部。</div><div class="line"></div><div class="line">             */</div><div class="line"></div><div class="line">//            int top=recyclerView.getHeight();</div><div class="line">//            recyclerView.scrollBy(0,top);</div><div class="line">//            int childcount=recyclerView.getChildCount();</div><div class="line">//            Log.i(&quot;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;,&quot;childcount&quot;+childcount);</div><div class="line">//            int top=recyclerView.getChildAt(moveCounts-firstItem).getTop();</div><div class="line">//            recyclerView.scrollBy(0,top);</div><div class="line"></div><div class="line">            recyclerView.scrollToPosition(moveCounts);</div><div class="line">            move=true;</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>监听回调，从底部滑动到顶部：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">class RecyclerViewListener extends RecyclerView.OnScrollListener&#123;</div><div class="line">        /*</div><div class="line">        监听回调，滑动结束回调。</div><div class="line">         */</div><div class="line">        @Override</div><div class="line">        public void onScrolled(RecyclerView recyclerView, int dx, int dy) &#123;</div><div class="line">            super.onScrolled(recyclerView, dx, dy);</div><div class="line">            //在这里进行第二次滚动（最后的100米！）</div><div class="line">            if (move )&#123;</div><div class="line">                move = false;</div><div class="line">                //获取要置顶的项在当前屏幕的位置，moveCount是记录的要置顶项在RecyclerView中的位置</div><div class="line">                int n = moveCounts - gridLayoutManager.findFirstVisibleItemPosition();</div><div class="line">                if ( 0 &lt;= n &amp;&amp; n &lt; recyclerView.getChildCount())&#123;</div><div class="line">                    //获取要置顶的项顶部离RecyclerView顶部的距离</div><div class="line">                    int top = recyclerView.getChildAt(n).getTop();</div><div class="line">                    //最后的移动</div><div class="line">                    recyclerView.scrollBy(0, top);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">            /*</div><div class="line">            监听回调，滑动状态改变回调</div><div class="line">             */</div><div class="line">        @Override</div><div class="line">        public void onScrollStateChanged(RecyclerView recyclerView, int newState) &#123;</div><div class="line">            super.onScrollStateChanged(recyclerView, newState);</div><div class="line"></div><div class="line">            if (move&amp;&amp;newState==RecyclerView.SCROLL_STATE_IDLE)</div><div class="line">            &#123;</div><div class="line">                move=false;</div><div class="line">                int n=moveCounts-gridLayoutManager.findFirstVisibleItemPosition();</div><div class="line">                if (0&lt;=n&amp;&amp;n&lt;recyclerView.getChildCount())</div><div class="line">                &#123;</div><div class="line">                    int top=recyclerView.getChildAt(n).getTop();</div><div class="line">                    recyclerView.scrollBy(0,top);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>这样我们就讲左边联动右边完成了。</p>
<h2 id="右边联动左边"><a href="#右边联动左边" class="headerlink" title="右边联动左边"></a>右边联动左边</h2><p>滑动右边的数据，前面我们在加载城市数据的时候，我们将城市和省份通过一个tag进行了绑定，当我们滑动的时候，获取这个tag（position）,让他与左边的position比较，不相同的话，就把tag赋值给position，有了这个position，我们就可以更改背景颜色了；</p>
<p>贴出关键代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">if (!TextUtils.equals(tag, currentTag)) &#123;</div><div class="line">           currentTag = tag;</div><div class="line">           Log.i(&quot;zhangcong&quot;,currentTag);</div><div class="line">           Integer integer = Integer.valueOf(currentTag);</div><div class="line">           mCheckListener.check(integer, false);</div><div class="line">       &#125;</div></pre></td></tr></table></figure>
<p>最后我们调用一个接口回调方法，让左边的省份背景改变。</p>
<h2 id="小bug"><a href="#小bug" class="headerlink" title="小bug"></a>小bug</h2><p>由于右边滑动的时候左边省份背景改变了，但是不在可见view中，我们将左边选中的省份一直显示在屏幕中间。通过recycleView设置下就可以。</p>
<p>代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">//将当前选中的item居中</div><div class="line">    public   void moveToCenter(int position) &#123;</div><div class="line">        //将点击的position转换为当前屏幕上可见的item的位置以便于计算距离顶部的高度，从而进行移动居中</div><div class="line">        Log.i(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;,position - manager.findFirstVisibleItemPosition()+&quot;eeeee&quot;);</div><div class="line">        int itemPosition=position-manager.findFirstVisibleItemPosition();</div><div class="line">        /*</div><div class="line">        当往上滑动太快，会出现itemPosition为-1的情况。做下判断</div><div class="line">         */</div><div class="line">        if (0&lt;itemPosition&amp;&amp;itemPosition&lt;manager.getChildCount())</div><div class="line">        &#123;</div><div class="line">            View childAt = recycleview.getChildAt(position - manager.findFirstVisibleItemPosition());</div><div class="line">            Log.i(&quot;&lt;&lt;&lt;&lt;&lt;&lt;&quot;,position - manager.findFirstVisibleItemPosition()+&quot;&quot;);</div><div class="line"></div><div class="line">            int y = (childAt.getTop() - recycleview.getHeight() / 2);</div><div class="line">            Log.i(&quot;&lt;&lt;&lt;&lt;&lt;&lt;&quot;,childAt.getTop()+&quot;ssssss&quot;);</div><div class="line">            Log.i(&quot;&lt;&lt;&lt;&lt;&lt;&lt;&quot;, y+&quot;&quot;);</div><div class="line">            recycleview.smoothScrollBy(0, y);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>在做右边联动左边的时候，当时想着获取title的position，然后将position传过去，进行背景的改变，这种方法是可行的，但是体验非常的不好，因为当你滑动很快的时候，是获取不到中间经过的省份的position，就感觉不连贯，直接跳到了最后你滑动的位置，所以换了一种解决思路(如果你以为是我想出来的你就太年轻了)。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总结的话就没有，前面思路讲的已经够清楚了。最后给大家一点看代码的兴趣，这里面还缺少了许多的城市和省份，大家看懂了这些代码的话可以在里面加上自己的城市，或者加上图片展示功能；然后提交pull request，我这边会帮你们merge的(请在添加代码的地方加上你自己的注释 如： Simon add  shanghai  city on 20170727)。也非常欢迎大家在底下留言，探讨一些问题，当然有看不明白的也可以提出问题，我会尽力解答的。大家觉得有帮助的话麻烦给我的github来一个star吧。</p>
<p>最后是github地址</p>
<p><a href="https://github.com/Simon986793021/WindLinkRecycleView" target="_blank" rel="external">https://github.com/Simon986793021/WindLinkRecycleView</a></p>

  </section>

  <section class="post-comments">

    <!-- 将评论系统（例如Disqus、多说、友言、畅言等）提供的代码片段粘贴在这里 -->
    
</section>


</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; 2014-2015. | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a></span>
    
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/blog/js/jquery.min.js"></script>
    <script src="/blog/js/main.js"></script>
    <script src="/blog/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/blog/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
